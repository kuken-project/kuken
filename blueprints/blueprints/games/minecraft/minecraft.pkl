/// # Minecraft: Java Edition Blueprint
///
/// KÃ¼ken blueprint for deploying Minecraft Java Edition servers using the [itzg/minecraft-server](https://github.com/itzg/docker-minecraft-server) Docker image.
module io.kuken.minecraft.Minecraft

amends "https://kuken.io/blueprints/reference/v1/Reference.pkl"

name = "Minecraft: Java Edition"
version = "1.0.0"
url = "https://kuken.io"

assets {
  icon = "https://kuken.io/blueprints/icons/minecraft-java-edition.png"
}

// ============================================================================
// INPUT DEFINITIONS
// ============================================================================

/// Docker image tag/version for the Minecraft server container.
local DockerImageVersion = textInput("docker-image-tag", "Docker Image Version")

/// RCON password for remote server management.
/// RCON allows command execution without direct console access, essential for automated management and integration tools.
local RconPassword = passwordInput("rcon-password", "RCON Password")

/// Network port for RCON connections.
/// Standard Minecraft RCON port is 25575. Change if running multiple servers or if the port conflicts with other services.
local RconPort = portInput("rcon-port", "RCON Port", 25575)

/// Maximum memory allocation for the Java server process.
local MaxMemory = dataSizeInput("max-memory", "Maximum Memory")

/// Minecraft version to run on the server.
/// Use `"LATEST"` for the newest release, specific versions like `"1.20.4"`, or `"SNAPSHOT"` for testing builds.
local GameVersion = textInput("game-version", "Minecraft Version")

/// Server type/distribution to run.
/// Options include `"VANILLA"` (default), `"PAPER"` (optimized), `"SPIGOT"`, `"FORGE"`, or `"FABRIC"`.
local ServerType = textInput("server-type", "Server Type")

// ============================================================================
// USER INPUTS
// ============================================================================

inputs {
  DockerImageVersion
  GameVersion
  ServerType
  MaxMemory
  RconPassword
  RconPort
}

// ============================================================================
// BUILD CONFIGURATION
// ============================================================================

build {
  docker {
    image = "itzg/minecraft-server:\(DockerImageVersion)"
  }

  environmentVariables {
    // Automatically accept the Minecraft EULA, required for server startup.
    new { name = "EULA"; value = true }
    new { name = "ENABLE_RCON"; value = true }
    new { name = "TYPE"; value = ServerType }
    new { name = "VERSION"; value = GameVersion }
    new { name = "MEMORY"; value = MaxMemory }
    new { name = "RCON_PASSWORD"; value = RconPassword }
    new { name = "RCON_PORT"; value = RconPort }
  }
}

instance {
  startup = "java Xms128M -jar server.jar"
}
